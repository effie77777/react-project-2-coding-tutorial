{"version":3,"file":"static/js/598.bd3792de.chunk.js","mappings":"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","sources":["pages/Finished.js","services/course-service.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport newCourseService from \"../services/course-service\";\r\n\r\nconst Finished = ({ currentUser }) => {\r\n    const Navigate = useNavigate();\r\n    const [ errorMsg, setErrorMsg ] = useState(null);\r\n\r\n    // 檢查使用者目前是否有尚未完成的訂單\r\n    function checkUnfinishedOrder() {\r\n        if (localStorage.getItem(\"order_from_customer\") && JSON.parse(localStorage.getItem(\"order_from_customer\")).isValid) {\r\n            Navigate(\"/checkOut\");\r\n        } else {\r\n            Navigate(\"/placeOrder\");\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!currentUser) {\r\n            setErrorMsg(\"請先登入或註冊\");\r\n            setTimeout(() => {\r\n                Navigate(\"/login\");\r\n            }, 2000);\r\n        } else if (localStorage.getItem(\"submission_hashed_result\")) { // 使用者剛付款成功，從綠界頁面過來\r\n            let hashedResult = JSON.parse(localStorage.getItem(\"submission_hashed_result\"));\r\n            let studentId = currentUser.data._id;\r\n            let course = JSON.parse(localStorage.getItem(\"current_search\"))[0];\r\n            let orderDetail = JSON.parse(localStorage.getItem(\"order_from_customer\"));\r\n            let classAmounts = JSON.parse(localStorage.getItem(\"purchase\"))[1];\r\n            newCourseService.checkIfPaymentFinished(hashedResult, studentId, course, orderDetail, classAmounts)\r\n            .then((d) => {\r\n                console.log(\"d is: \", d);\r\n                // if (d.data === \"訂單儲存成功\") {\r\n                //     localStorage.removeItem(\"submitted_ecpay_form\");\r\n                //     localStorage.removeItem(\"form_from_ecpay\");\r\n                //     localStorage.removeItem(\"order_from_customer\");\r\n                //     localStorage.removeItem(\"purchase\");        \r\n                // } else if (d.data === \"訂單驗證失敗\") {\r\n                //     if (localStorage.getItem(\"purchase\")) {\r\n                //         setErrorMsg(\"訂單尚未完成，將為您重新導向\");\r\n                //         checkUnfinishedOrder();\r\n                //     } else {\r\n                //         setErrorMsg(\"目前沒有進行中的訂單哦，如欲查詢已完成的訂單請至個人頁面\");\r\n                //     }\r\n                // }\r\n            })\r\n            .catch((e) => {\r\n                console.log(e);\r\n            })\r\n        } else if (localStorage.getItem(\"purchase\")) {\r\n            setErrorMsg(\"訂單尚未完成，將為您重新導向\");\r\n            setTimeout(() => {\r\n                checkUnfinishedOrder();                \r\n            }, 2000);    \r\n        } else {\r\n            setErrorMsg(\"目前沒有進行中的訂單哦，如欲查詢已完成的訂單請至個人頁面\");\r\n        }\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"container-fluid\">\r\n            \r\n            {errorMsg\r\n            ? <div className=\"error_msg\">{errorMsg}</div>\r\n            : <div>\r\n                <section className=\"py-11\">\r\n                    <div className=\"row\">\r\n                        <div className=\"col-12 d-flex justify-content-center\">\r\n                            <div className=\"progress_bar\">\r\n                                <div className=\"border-top\"></div>\r\n                                <div>\r\n                                    <div>\r\n                                        <small>1</small>\r\n                                    </div>\r\n                                    <p>填寫購買資料</p>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"bg-linear border-0\">\r\n                                        <small className=\"text-dark\">2</small>\r\n                                    </div>\r\n                                    <p>確認訂單資訊</p>\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"bg-linear border-0\">\r\n                                        <small className=\"text-dark\">3</small>\r\n                                    </div>\r\n                                    <p>成功註冊課程</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n\r\n                <section className=\"mt-12\">\r\n                    <div className=\"row align-items-center\">\r\n                        <div className=\"col-12 d-flex justify-content-center\">\r\n                            <div className=\"col-sm-8 col-lg-4 px-8 py-12 bg-third bg-opacity-10 d-flex flex-column align-items-center\" style={{ maxWidth: \"450px\" }}>\r\n                                <div className=\"d-flex align-items-center mb-8\">\r\n                                    <span class=\"material-symbols-outlined text-primary me-3\" style={{fontSize: \"2.75rem\", transform: \"translateY(-10%)\"}}>\r\n                                        new_releases\r\n                                    </span>\r\n                                    <h3 className=\"text-white fw-bold fs-4\">完成訂購</h3>\r\n                                </div>\r\n                                <p className=\"mb-10 text-white\">恭喜您已成功購買課程，請注意郵件訊息，家教老師將與您聯繫！您可至個人頁面查看已購買的課程。</p>\r\n                                <div className=\"d-flex flex-column align-items-center\">\r\n                                    <Link className=\"btn bg-linear text-dark px-12 py-2 mb-3\" to=\"/class\">探索更多課程</Link>\r\n                                    <Link className=\"btn text-white border px-12 py-2\" to=\"/profile\">回到個人頁面</Link>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </section>\r\n            </div>}\r\n\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Finished;","import axios from \"axios\";\r\nconst basic_api = \"https://react-project-2-coding-tutorial-backend.onrender.com/api/course\";\r\n// const basic_api = \"http://localhost:8080/api/course\";\r\n\r\nclass courseService {\r\n    searchAllCourses() {\r\n        let token;\r\n        if (localStorage.getItem(\"user_data\")) {\r\n            token = JSON.parse(localStorage.getItem(\"user_data\")).token;\r\n        } else {\r\n            token = \"\";\r\n        }\r\n        return axios.get(\r\n            `${basic_api}/search`,\r\n            { headers: { Authorization: token } }\r\n        );\r\n    }\r\n\r\n    // 準備結帳\r\n    checkOut(ItemName, TotalAmount) {\r\n        let token;\r\n        if (localStorage.getItem(\"user_data\")) {\r\n            token = JSON.parse(localStorage.getItem(\"user_data\")).token;\r\n        } else {\r\n            token = \"\";\r\n        }\r\n        return axios.get(\r\n            `${basic_api}/payment/${ItemName}/${TotalAmount}`,\r\n            { headers: { Authorization: token } }\r\n        )\r\n    }\r\n\r\n    // 付款成功後\r\n    enroll(studentId, course, orderDetail, classAmounts) {\r\n        let token;\r\n        localStorage.getItem(\"user_data\")\r\n        ? token = JSON.parse(localStorage.getItem(\"user_data\")).token\r\n        : token = \"\";\r\n        return axios.post(\r\n            `${basic_api}/enroll`,\r\n            { studentId, course, orderDetail, classAmounts },\r\n            { headers: { Authorization: token } }\r\n        );\r\n    }\r\n\r\n    getMyOrders(studentId) {\r\n        let token;\r\n        localStorage.getItem(\"user_data\")\r\n        ? token = JSON.parse(localStorage.getItem(\"user_data\")).token\r\n        : token = \"\";\r\n        return axios.get(\r\n            `${basic_api}/getMyOrders/${studentId}`,\r\n            { headers: { Authorization: token } }\r\n        );\r\n    }\r\n\r\n    checkIfPaymentFinished(hashed_result, studentId, course, orderDetail, classAmounts) {\r\n        let token;\r\n        localStorage.getItem(\"user_data\")\r\n        ? token = JSON.parse(localStorage.getItem(\"user_data\")).token\r\n        : token = \"\";\r\n        return axios.post(\r\n            `${basic_api}/checkIfPaymentFinished`,\r\n            { hashed_result, studentId, course, orderDetail, classAmounts },\r\n            { headers: { Authorization: token } }\r\n        );\r\n    }\r\n}\r\n\r\nconst newCourseService = new courseService();\r\nexport default newCourseService;"],"names":["_ref","currentUser","Navigate","useNavigate","_useState","useState","_useState2","_slicedToArray","errorMsg","setErrorMsg","useEffect","localStorage","getItem","hashedResult","JSON","parse","studentId","data","_id","course","orderDetail","classAmounts","newCourseService","checkIfPaymentFinished","then","d","console","log","catch","e","setTimeout","isValid","_jsx","className","children","_jsxs","style","maxWidth","class","fontSize","transform","Link","to","basic_api","courseService","_classCallCheck","_createClass","key","value","token","axios","get","concat","headers","Authorization","ItemName","TotalAmount","post","hashed_result"],"sourceRoot":""}